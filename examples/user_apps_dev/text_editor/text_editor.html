<div class="app-container">
    <div class="app-header">
        <h2><i class="fas fa-edit"></i> Text Editor - <span id="current-filename">untitled.txt</span></h2>
        <p>Create and edit text files in the virtual file system</p>
    </div>

    <div class="app-content">
        <div class="app-toolbar">
            <div class="app-btn-group">
                <button id="new-file" class="app-btn primary">
                    <i class="fas fa-file"></i> New
                </button>
                <button id="load-file" class="app-btn secondary">
                    <i class="fas fa-folder-open"></i> Load
                </button>
                <button id="save-file" class="app-btn primary">
                    <i class="fas fa-save"></i> Save
                </button>
                <button id="save-as-file" class="app-btn secondary">
                    <i class="fas fa-save"></i> Save As
                </button>
            </div>
            

            
            <div class="app-btn-group">
                <button id="word-wrap-toggle" class="app-btn secondary">
                    <i class="fas fa-text-width"></i> Word Wrap
                </button>
                <button id="line-numbers-toggle" class="app-btn secondary">
                    <i class="fas fa-list-ol"></i> Line Numbers
                </button>
            </div>
        </div>

        <div class="editor-container">
            <div class="editor-wrapper">
                <div id="line-numbers" class="line-numbers"></div>
                <textarea id="text-editor" class="app-textarea" placeholder="Start typing your text here..."></textarea>
            </div>
        </div>

        <div class="editor-status">
            <div class="status-item">
                <span class="status-label">Modified:</span>
                <span class="status-value" id="modified-status">No</span>
            </div>
        </div>
    </div>
</div> 
<style>/* Text Editor App Styles */

/* App Container */
.app-container {
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 0;
}

.app-content {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 0;
}

/* Editor Container */
.editor-container {
    flex: 1;
    background: var(--primary-bg);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    overflow: hidden;
    margin: 15px 0;
    min-height: 200px;
    display: flex;
    flex-direction: column;
}

.editor-wrapper {
    display: flex;
    flex: 1;
    position: relative;
    height: 100%;
}

/* Line Numbers */
.line-numbers {
    background: var(--glass-bg);
    border-right: 1px solid var(--border-color);
    padding: 10px 8px;
    font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
    font-size: 12px;
    color: var(--text-muted);
    text-align: right;
    min-width: 50px;
    user-select: none;
    overflow-y: hidden;
    line-height: 1.6;
    flex-shrink: 0;
}

.line-numbers.hidden {
    display: none;
}

.line-number {
    display: block;
    padding: 0 4px;
}

/* Text Editor */
#text-editor {
    flex: 1;
    background: var(--primary-bg);
    border: none;
    color: var(--text-primary);
    font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
    font-size: 14px;
    line-height: 1.6;
    padding: 10px 15px;
    resize: none;
    outline: none;
    overflow-y: auto;
    overflow-x: auto;
    white-space: pre;
    tab-size: 4;
    height: 100%;
    box-sizing: border-box;
}

#text-editor.word-wrap {
    white-space: pre-wrap;
    word-wrap: break-word;
}

#text-editor::placeholder {
    color: var(--text-muted);
}

/* Editor Status Bar */
.editor-status {
    display: flex;
    gap: 20px;
    padding: 10px 15px;
    background: var(--glass-bg);
    border-top: 1px solid var(--border-color);
    font-size: 12px;
    color: var(--text-secondary);
    flex-shrink: 0;
}

.status-item {
    display: flex;
    gap: 5px;
    align-items: center;
}

.status-label {
    font-weight: 500;
}

.status-value {
    color: var(--accent-color);
    font-weight: 600;
}

/* File Path Display */
.file-path-display {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 6px;
    padding: 10px 15px;
    min-width: 200px;
    font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
    color: var(--text-primary);
    font-size: 14px;
    word-break: break-all;
}

/* Responsive Design */
@media (max-width: 768px) {
    .app-toolbar {
        flex-direction: column;
        gap: 10px;
    }
    
    .app-btn-group {
        justify-content: center;
    }
    
    .editor-status {
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .line-numbers {
        min-width: 40px;
        font-size: 11px;
    }
    
    #text-editor {
        font-size: 13px;
    }
}

/* Focus States */
#text-editor:focus {
    background: var(--primary-bg);
}

/* Scrollbar Styling */
#text-editor::-webkit-scrollbar,
.line-numbers::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

#text-editor::-webkit-scrollbar-track,
.line-numbers::-webkit-scrollbar-track {
    background: var(--glass-bg);
}

#text-editor::-webkit-scrollbar-thumb,
.line-numbers::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 4px;
}

#text-editor::-webkit-scrollbar-thumb:hover,
.line-numbers::-webkit-scrollbar-thumb:hover {
    background: var(--accent-color);
}

/* App Toolbar */
.app-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: var(--glass-bg);
    border-bottom: 1px solid var(--border-color);
    flex-shrink: 0;
}

.app-btn-group {
    display: flex;
    gap: 10px;
}

/* Animation for status changes */
.status-value {
    transition: color 0.2s ease;
}

/* Modified status indicator */
.status-value.modified {
    color: #ff9800;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
} </style>
<script>// ===== Script: main.js =====


// Text Editor App
console.log('Text Editor app loading...');
console.log('Document ready state:', document.readyState);
console.log('Document body:', document.body);
console.log('Window sypnexAPI:', typeof window.sypnexAPI);

// Global variables
let textEditor = {
    textarea: null,
    lineNumbers: null,
    filePath: null,
    originalContent: '',
    isModified: false,
    autoSaveInterval: null,
    wordWrapEnabled: false,
    lineNumbersEnabled: true,
    settings: {}
};

// DOM elements
let newFileBtn, loadFileBtn, saveFileBtn, saveAsFileBtn;
let currentFilenameEl, wordWrapToggle, lineNumbersToggle;
let modifiedStatusEl;

// Initialize when DOM is ready
function initTextEditor() {
    console.log('Text Editor initializing...');
    
    // Check if SypnexAPI is available
    if (typeof sypnexAPI === 'undefined' || !sypnexAPI) {
        console.warn('SypnexAPI not available - running in standalone mode');
        return;
    }

    console.log('SypnexAPI available:', sypnexAPI);
    console.log('App ID:', sypnexAPI.getAppId());
    
    // Test if app container exists
    const appContainer = document.querySelector('.app-container');
    console.log('App container found:', !!appContainer);
    if (appContainer) {
        console.log('App container content:', appContainer.innerHTML.substring(0, 200) + '...');
    }
    
    // Get DOM elements
    textEditor.textarea = document.getElementById('text-editor');
    textEditor.lineNumbers = document.getElementById('line-numbers');
    
    newFileBtn = document.getElementById('new-file');
    loadFileBtn = document.getElementById('load-file');
    saveFileBtn = document.getElementById('save-file');
    saveAsFileBtn = document.getElementById('save-as-file');
    currentFilenameEl = document.getElementById('current-filename');
    wordWrapToggle = document.getElementById('word-wrap-toggle');
    lineNumbersToggle = document.getElementById('line-numbers-toggle');
    
    modifiedStatusEl = document.getElementById('modified-status');
    
    // Critical element checks
    if (!textEditor.textarea) {
        console.error('Text editor textarea not found');
        return;
    }
    
    if (!textEditor.lineNumbers) {
        console.error('Line numbers element not found');
        return;
    }
    
    console.log('DOM elements found:', {
        textarea: !!textEditor.textarea,
        lineNumbers: !!textEditor.lineNumbers,
        newFileBtn: !!newFileBtn,
        loadFileBtn: !!loadFileBtn,
        saveFileBtn: !!saveFileBtn,
        saveAsFileBtn: !!saveAsFileBtn,
        currentFilenameEl: !!currentFilenameEl,
        modifiedStatusEl: !!modifiedStatusEl
    });
    
    // Load settings
    loadSettings();
    
    // Set up event handlers
    setupEventHandlers();
    
    // Initialize editor state
    initializeEditor();
    
    // Text Editor loaded successfully (no notification needed)
    
    console.log('Text Editor initialization complete');
}

// Load app settings
async function loadSettings() {
    try {
        textEditor.settings = {
            autoSaveInterval: await sypnexAPI.getSetting('AUTO_SAVE_INTERVAL', 30),
            fontSize: await sypnexAPI.getSetting('FONT_SIZE', 14),
            tabSize: await sypnexAPI.getSetting('TAB_SIZE', 4)
        };
        
        // Apply settings
        textEditor.textarea.style.fontSize = textEditor.settings.fontSize + 'px';
        textEditor.textarea.style.tabSize = textEditor.settings.tabSize;
        
        console.log('Settings loaded:', textEditor.settings);
    } catch (error) {
        console.error('Failed to load settings:', error);
        // Use defaults
        textEditor.settings = {
            autoSaveInterval: 30,
            fontSize: 14,
            tabSize: 4
        };
    }
}

// Set up event handlers
function setupEventHandlers() {
    // Button events
    newFileBtn?.addEventListener('click', createNewFile);
    loadFileBtn?.addEventListener('click', loadFile);
    saveFileBtn?.addEventListener('click', saveFile);
    saveAsFileBtn?.addEventListener('click', saveAsFile);
    wordWrapToggle?.addEventListener('click', toggleWordWrap);
    lineNumbersToggle?.addEventListener('click', toggleLineNumbers);
    
    // Textarea events
    textEditor.textarea.addEventListener('input', handleTextChange);
    textEditor.textarea.addEventListener('scroll', syncScroll);
    textEditor.textarea.addEventListener('keydown', handleKeyDown);
    

    
    // Window events
    window.addEventListener('beforeunload', handleBeforeUnload);
}

// Update filename display
function updateFilenameDisplay() {
    if (currentFilenameEl) {
        const filename = textEditor.filePath ? textEditor.filePath.split('/').pop() : 'untitled.txt';
        currentFilenameEl.textContent = filename;
    }
}

// Initialize editor state
function initializeEditor() {
    // Set initial file path
    textEditor.filePath = '/untitled.txt';
    updateFilenameDisplay();
    
    // Update line numbers
    updateLineNumbers();
    
    // Update status
    updateStatus();
    
    // Start auto-save if enabled
    if (textEditor.settings.autoSaveInterval > 0) {
        startAutoSave();
    }
}

// Handle text changes
function handleTextChange() {
    updateLineNumbers();
    updateStatus();
    markAsModified();
}

// Update line numbers
function updateLineNumbers() {
    if (!textEditor.lineNumbers || !textEditor.lineNumbersEnabled) return;
    
    const lines = textEditor.textarea.value.split('\n');
    const lineCount = lines.length;
    
    // Generate line numbers HTML
    let lineNumbersHTML = '';
    for (let i = 1; i <= lineCount; i++) {
        lineNumbersHTML += `<span class="line-number">${i}</span>\n`;
    }
    
    textEditor.lineNumbers.innerHTML = lineNumbersHTML;
}

// Sync scroll between textarea and line numbers
function syncScroll() {
    if (textEditor.lineNumbers && textEditor.lineNumbersEnabled) {
        textEditor.lineNumbers.scrollTop = textEditor.textarea.scrollTop;
    }
}

// Update status bar
function updateStatus() {
    // Status bar now only shows modified status, which is handled by markAsModified/markAsSaved
    // This function is kept for potential future use
}

// Mark file as modified
function markAsModified() {
    if (!textEditor.isModified) {
        textEditor.isModified = true;
        if (modifiedStatusEl) {
            modifiedStatusEl.textContent = 'Yes';
            modifiedStatusEl.classList.add('modified');
        }
    }
}

// Mark file as saved
function markAsSaved() {
    textEditor.isModified = false;
    textEditor.originalContent = textEditor.textarea.value;
    if (modifiedStatusEl) {
        modifiedStatusEl.textContent = 'No';
        modifiedStatusEl.classList.remove('modified');
    }
}

// Create new file
function createNewFile() {
    if (textEditor.isModified) {
        if (confirm('You have unsaved changes. Create new file anyway?')) {
            clearEditor();
        }
    } else {
        clearEditor();
    }
}

// Clear editor
function clearEditor() {
    textEditor.textarea.value = '';
    textEditor.filePath = '/untitled.txt';
    updateFilenameDisplay();
    textEditor.originalContent = '';
    markAsSaved();
    updateLineNumbers();
    updateStatus();
    textEditor.textarea.focus();
}

// Load file from VFS
async function loadFile() {
    try {
        const filePath = await sypnexAPI.showFileExplorer({
            mode: 'open',
            title: 'Open Text File',
            initialPath: '/',
            onSelect: (selectedPath) => {
                console.log('File selected for loading:', selectedPath);
            },
            onCancel: () => {
                console.log('File selection cancelled');
            }
        });
        
        if (!filePath) {
            return; // User cancelled
        }
        
        // Check if file exists and load it
        const content = await sypnexAPI.readVirtualFileText(filePath);
        
        // Load content into editor
        textEditor.textarea.value = content;
        textEditor.filePath = filePath;
        textEditor.originalContent = content;
        
        // Update UI
        updateFilenameDisplay();
        updateLineNumbers();
        updateStatus();
        markAsSaved();
        
        sypnexAPI.showNotification(`File loaded: ${filePath}`, 'success');
        
    } catch (error) {
        console.error('Failed to load file:', error);
        sypnexAPI.showNotification(`Failed to load file: ${error.message}`, 'error');
    }
}

// Save file to VFS
async function saveFile() {
    const content = textEditor.textarea.value;
    
    try {
        let filePath = textEditor.filePath;
        
        // If it's a new file (untitled) or we want to save as, show file explorer
        if (textEditor.filePath === '/untitled.txt') {
            filePath = await sypnexAPI.showFileExplorer({
                mode: 'save',
                title: 'Save Text File',
                initialPath: '/',
                fileName: 'untitled.txt',
                onSelect: (selectedPath) => {
                    console.log('File selected for saving:', selectedPath);
                },
                onCancel: () => {
                    console.log('File selection cancelled');
                }
            });
            
            if (!filePath) {
                return; // User cancelled
            }
        }
        
        await sypnexAPI.writeVirtualFile(filePath, content);
        
        textEditor.filePath = filePath;
        updateFilenameDisplay();
        markAsSaved();
        
        sypnexAPI.showNotification(`File saved: ${filePath}`, 'success');
        
    } catch (error) {
        console.error('Failed to save file:', error);
        sypnexAPI.showNotification(`Failed to save file: ${error.message}`, 'error');
    }
}

// Save file as (always show file explorer)
async function saveAsFile() {
    const content = textEditor.textarea.value;
    
    try {
        const filePath = await sypnexAPI.showFileExplorer({
            mode: 'save',
            title: 'Save Text File As',
            initialPath: '/',
            fileName: textEditor.filePath === '/untitled.txt' ? 'untitled.txt' : textEditor.filePath.split('/').pop(),
            onSelect: (selectedPath) => {
                console.log('File selected for saving as:', selectedPath);
            },
            onCancel: () => {
                console.log('File selection cancelled');
            }
        });
        
        if (!filePath) {
            return; // User cancelled
        }
        
        await sypnexAPI.writeVirtualFile(filePath, content);
        
        textEditor.filePath = filePath;
        updateFilenameDisplay();
        markAsSaved();
        
        sypnexAPI.showNotification(`File saved as: ${filePath}`, 'success');
        
    } catch (error) {
        console.error('Failed to save file as:', error);
        sypnexAPI.showNotification(`Failed to save file as: ${error.message}`, 'error');
    }
}

// Toggle word wrap
function toggleWordWrap() {
    textEditor.wordWrapEnabled = !textEditor.wordWrapEnabled;
    textEditor.textarea.classList.toggle('word-wrap', textEditor.wordWrapEnabled);
    
    if (wordWrapToggle) {
        wordWrapToggle.classList.toggle('active', textEditor.wordWrapEnabled);
    }
    
    sypnexAPI.showNotification(
        `Word wrap ${textEditor.wordWrapEnabled ? 'enabled' : 'disabled'}`,
        'info'
    );
}

// Toggle line numbers
function toggleLineNumbers() {
    textEditor.lineNumbersEnabled = !textEditor.lineNumbersEnabled;
    textEditor.lineNumbers.classList.toggle('hidden', !textEditor.lineNumbersEnabled);
    
    if (lineNumbersToggle) {
        lineNumbersToggle.classList.toggle('active', textEditor.lineNumbersEnabled);
    }
    
    if (textEditor.lineNumbersEnabled) {
        updateLineNumbers();
    }
    
    sypnexAPI.showNotification(
        `Line numbers ${textEditor.lineNumbersEnabled ? 'enabled' : 'disabled'}`,
        'info'
    );
}



// Handle keyboard shortcuts
function handleKeyDown(e) {
    // Ctrl/Cmd + S: Save
    if ((e.ctrlKey || e.metaKey) && e.key === 's' && !e.shiftKey) {
        e.preventDefault();
        saveFile();
    }
    
    // Ctrl/Cmd + Shift + S: Save As
    if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'S') {
        e.preventDefault();
        saveAsFile();
    }
    
    // Ctrl/Cmd + N: New file
    if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
        e.preventDefault();
        createNewFile();
    }
    
    // Ctrl/Cmd + O: Load file
    if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
        e.preventDefault();
        loadFile();
    }
    
    // Tab handling
    if (e.key === 'Tab') {
        e.preventDefault();
        const start = textEditor.textarea.selectionStart;
        const end = textEditor.textarea.selectionEnd;
        const spaces = ' '.repeat(textEditor.settings.tabSize);
        
        textEditor.textarea.value = 
            textEditor.textarea.value.substring(0, start) + 
            spaces + 
            textEditor.textarea.value.substring(end);
        
        textEditor.textarea.selectionStart = textEditor.textarea.selectionEnd = start + spaces.length;
    }
}

// Start auto-save
function startAutoSave() {
    if (textEditor.autoSaveInterval) {
        clearInterval(textEditor.autoSaveInterval);
    }
    
    textEditor.autoSaveInterval = setInterval(() => {
        if (textEditor.isModified && textEditor.filePath && textEditor.filePath !== '/untitled.txt') {
            saveFile();
        }
    }, textEditor.settings.autoSaveInterval * 1000);
    
    console.log(`Auto-save enabled every ${textEditor.settings.autoSaveInterval} seconds`);
}

// Stop auto-save
function stopAutoSave() {
    if (textEditor.autoSaveInterval) {
        clearInterval(textEditor.autoSaveInterval);
        textEditor.autoSaveInterval = null;
    }
}

// Handle before unload
function handleBeforeUnload(e) {
    if (textEditor.isModified) {
        e.preventDefault();
        e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
        return e.returnValue;
    }
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTextEditor);
} else {
    // DOM is already loaded
    initTextEditor();
}

console.log('Text Editor script loaded');
console.log('=== TEXT EDITOR DEBUG INFO ===');
console.log('Document ready state:', document.readyState);
console.log('Document body exists:', !!document.body);
console.log('Window sypnexAPI type:', typeof window.sypnexAPI);
console.log('Global sypnexAPI type:', typeof sypnexAPI);
console.log('App container exists:', !!document.querySelector('.app-container'));
console.log('Text editor textarea exists:', !!document.getElementById('text-editor'));
console.log('Line numbers exists:', !!document.getElementById('line-numbers'));
console.log('=== END DEBUG INFO ==='); </script>